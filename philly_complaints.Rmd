---
title: "Complaints Against Philly Police"
author: "Yao Yu"
date: "6/2/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Loading in necessary packages

library(tidyverse)

# Reading in complaints data with details: https://www.opendataphilly.org/dataset/police-complaints

philly <- read_csv("ppd_complaints.csv", col_types = cols(
  complaint_id = col_character(),
  date_received = col_date(format = ""),
  district_occurrence = col_character(),
  general_cap_classification = col_character(),
  summary = col_character()
))

# Reading in complaints data with demographics

demographics <- read_csv("ppd_complainant_demographics.csv", col_types = cols(
  complaint_id = col_character(),
  complainant_sex = col_character(),
  complainant_race = col_character(),
  complainant_age = col_double()
))

# Reading in complaints data disciplines

disciplines <- read_csv("ppd_complaint_disciplines.csv", col_types = cols(
  complaint_id = col_character(),
  officer_id = col_double(),
  po_race = col_character(),
  po_sex = col_character(),
  po_assigned_unit = col_character(),
  allegations_investigated = col_character(),
  investigative_findings = col_character(),
  disciplinary_findings = col_character()
))

# Joining complaints with demographics and disciplines by complaint_id

philly_full <- philly %>%
  full_join(demographics, by = "complaint_id") %>%
  full_join(disciplines, by = "complaint_id")
```

```{r cleaning}

# Cleaning data for visualization. I pull out the year from the date and then
# select the necessary variables. Next, I group complaints from people that are
# not White or Black and NA values into a separate group because they make up a
# smaller proportion of complaints and are not the main focus of the article.
# The last drop_na() is to remove one row of data with no category variable.

philly_clean <- philly_full %>%
  mutate(year = format(as.Date(date_received, format = "%Y-%m-%d"), "%Y")) %>%
  select(year, district_occurrence, general_cap_classification, complainant_race) %>%
  mutate(race = case_when(
    complainant_race == "black" ~ "black",
    complainant_race == "white" ~ "white",
    TRUE ~ "other/NA"
  )) %>% 
  drop_na(general_cap_classification)

```

```{r graph 1}

# Preparing data for viz

data_category_race <- philly_clean %>% 
  group_by(race) %>%
  count(general_cap_classification)

# First viz breaks down all complaints into categories and race.

complaints_by_category_race <- data_category_race %>%
  ggplot(aes(x = reorder(general_cap_classification, n), y = n, fill = reorder(race, -n))) +
  geom_col() +
  coord_flip() +
  theme_classic() +
  labs(title = "Number of Complaints Made Against Philly Police by Race",
       subtitle = "split into categories from May 2015 to April 2020",
       x = "Type of Complaint",
       y = "",
       fill = "Race",
       caption = "Source: City of Philadelphia via OpenDataPhilly")

complaints_by_category_race

```

```{r graph 2}

# Preparing data for viz

data_year_race <- philly_clean %>% 
  group_by(year, race) %>% 
  count()

# Second viz breaks down all complaints by year and race.

complaints_by_year_race <- data_year_race %>% 
  ggplot(aes(x = year, y = n, fill = reorder(race, -n))) +
  geom_col(position = "dodge") +
  theme_classic() +
  labs(title = "Number of Complaints Made Against Philly Police by Race",
       subtitle = "yearly from May 2015 to April 2020",
       x = "",
       y = "",
       fill = "Race",
       caption = "Source: City of Philadelphia via OpenDataPhilly")

complaints_by_year_race

```

```{r graph 3}

```

